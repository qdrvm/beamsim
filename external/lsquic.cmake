set(lsquic_dir ${CMAKE_CURRENT_LIST_DIR}/lsquic)

add_library(lsquic
  ${lsquic_dir}/src/liblsquic/ls-qpack/lsqpack.c
  ${lsquic_dir}/src/liblsquic/ls-sfparser.c
  ${lsquic_dir}/src/liblsquic/lsquic_adaptive_cc.c
  ${lsquic_dir}/src/liblsquic/lsquic_alarmset.c
  ${lsquic_dir}/src/liblsquic/lsquic_arr.c
  ${lsquic_dir}/src/liblsquic/lsquic_attq.c
  ${lsquic_dir}/src/liblsquic/lsquic_bbr.c
  ${lsquic_dir}/src/liblsquic/lsquic_bw_sampler.c
  ${lsquic_dir}/src/liblsquic/lsquic_cfcw.c
  ${lsquic_dir}/src/liblsquic/lsquic_chsk_stream.c
  ${lsquic_dir}/src/liblsquic/lsquic_conn.c
  ${lsquic_dir}/src/liblsquic/lsquic_crand.c
  ${lsquic_dir}/src/liblsquic/lsquic_crt_compress.c
  ${lsquic_dir}/src/liblsquic/lsquic_crypto.c
  ${lsquic_dir}/src/liblsquic/lsquic_cubic.c
  ${lsquic_dir}/src/liblsquic/lsquic_di_error.c
  ${lsquic_dir}/src/liblsquic/lsquic_di_hash.c
  ${lsquic_dir}/src/liblsquic/lsquic_di_nocopy.c
  ${lsquic_dir}/src/liblsquic/lsquic_enc_sess_common.c
  ${lsquic_dir}/src/liblsquic/lsquic_enc_sess_ietf.c
  ${lsquic_dir}/src/liblsquic/lsquic_eng_hist.c
  ${lsquic_dir}/src/liblsquic/lsquic_engine.c
  ${lsquic_dir}/src/liblsquic/lsquic_ev_log.c
  ${lsquic_dir}/src/liblsquic/lsquic_frab_list.c
  ${lsquic_dir}/src/liblsquic/lsquic_frame_common.c
  ${lsquic_dir}/src/liblsquic/lsquic_frame_reader.c
  ${lsquic_dir}/src/liblsquic/lsquic_frame_writer.c
  ${lsquic_dir}/src/liblsquic/lsquic_full_conn.c
  ${lsquic_dir}/src/liblsquic/lsquic_full_conn_ietf.c
  ${lsquic_dir}/src/liblsquic/lsquic_global.c
  ${lsquic_dir}/src/liblsquic/lsquic_handshake.c
  ${lsquic_dir}/src/liblsquic/lsquic_hash.c
  ${lsquic_dir}/src/liblsquic/lsquic_hcsi_reader.c
  ${lsquic_dir}/src/liblsquic/lsquic_hcso_writer.c
  ${lsquic_dir}/src/liblsquic/lsquic_headers_stream.c
  ${lsquic_dir}/src/liblsquic/lsquic_hkdf.c
  ${lsquic_dir}/src/liblsquic/lsquic_hpi.c
  ${lsquic_dir}/src/liblsquic/lsquic_hspack_valid.c
  ${lsquic_dir}/src/liblsquic/lsquic_http.c
  ${lsquic_dir}/src/liblsquic/lsquic_http1x_if.c
  ${lsquic_dir}/src/liblsquic/lsquic_logger.c
  ${lsquic_dir}/src/liblsquic/lsquic_malo.c
  ${lsquic_dir}/src/liblsquic/lsquic_min_heap.c
  ${lsquic_dir}/src/liblsquic/lsquic_mini_conn.c
  ${lsquic_dir}/src/liblsquic/lsquic_mini_conn_ietf.c
  ${lsquic_dir}/src/liblsquic/lsquic_minmax.c
  ${lsquic_dir}/src/liblsquic/lsquic_mm.c
  ${lsquic_dir}/src/liblsquic/lsquic_pacer.c
  ${lsquic_dir}/src/liblsquic/lsquic_packet_common.c
  ${lsquic_dir}/src/liblsquic/lsquic_packet_gquic.c
  ${lsquic_dir}/src/liblsquic/lsquic_packet_in.c
  ${lsquic_dir}/src/liblsquic/lsquic_packet_out.c
  ${lsquic_dir}/src/liblsquic/lsquic_packet_resize.c
  ${lsquic_dir}/src/liblsquic/lsquic_parse_Q046.c
  ${lsquic_dir}/src/liblsquic/lsquic_parse_Q050.c
  ${lsquic_dir}/src/liblsquic/lsquic_parse_common.c
  ${lsquic_dir}/src/liblsquic/lsquic_parse_gquic_be.c
  ${lsquic_dir}/src/liblsquic/lsquic_parse_gquic_common.c
  ${lsquic_dir}/src/liblsquic/lsquic_parse_ietf_v1.c
  ${lsquic_dir}/src/liblsquic/lsquic_parse_iquic_common.c
  ${lsquic_dir}/src/liblsquic/lsquic_pr_queue.c
  ${lsquic_dir}/src/liblsquic/lsquic_purga.c
  ${lsquic_dir}/src/liblsquic/lsquic_qdec_hdl.c
  ${lsquic_dir}/src/liblsquic/lsquic_qenc_hdl.c
  ${lsquic_dir}/src/liblsquic/lsquic_qlog.c
  ${lsquic_dir}/src/liblsquic/lsquic_qpack_exp.c
  ${lsquic_dir}/src/liblsquic/lsquic_rechist.c
  ${lsquic_dir}/src/liblsquic/lsquic_rtt.c
  ${lsquic_dir}/src/liblsquic/lsquic_send_ctl.c
  ${lsquic_dir}/src/liblsquic/lsquic_senhist.c
  ${lsquic_dir}/src/liblsquic/lsquic_set.c
  ${lsquic_dir}/src/liblsquic/lsquic_sfcw.c
  ${lsquic_dir}/src/liblsquic/lsquic_shsk_stream.c
  ${lsquic_dir}/src/liblsquic/lsquic_spi.c
  ${lsquic_dir}/src/liblsquic/lsquic_stock_shi.c
  ${lsquic_dir}/src/liblsquic/lsquic_str.c
  ${lsquic_dir}/src/liblsquic/lsquic_stream.c
  ${lsquic_dir}/src/liblsquic/lsquic_tokgen.c
  ${lsquic_dir}/src/liblsquic/lsquic_trans_params.c
  ${lsquic_dir}/src/liblsquic/lsquic_trechist.c
  ${lsquic_dir}/src/liblsquic/lsquic_util.c
  ${lsquic_dir}/src/liblsquic/lsquic_varint.c
  ${lsquic_dir}/src/liblsquic/lsquic_version.c
  ${lsquic_dir}/src/lshpack/lshpack.c

  ${lsquic_dir}/src/boringssl.cpp
  ${lsquic_dir}/src/lsquic-ns3.cpp
)
target_compile_definitions(lsquic PRIVATE
  XXH_HEADER_NAME="../liblsquic/lsquic_xxhash.h"
)
target_compile_options(lsquic PRIVATE
  -Wno-unused-parameter
  -Wno-sign-compare
)
target_include_directories(lsquic PUBLIC
  ${lsquic_dir}/include
  ${lsquic_dir}/src/liblsquic/ls-qpack
  ${lsquic_dir}/src/lshpack
)
target_link_libraries(lsquic
  ns3::applications
  ns3::internet
  ns3::point-to-point
  ssl
  crypto
  xxhash
  zlibstatic
)
